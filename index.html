<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 ê²½ê¸°ë„ë¬¸í™”ì›ì—°í•©íšŒ í•©ë™ì—°ìˆ˜ ë°¸ëŸ°ìŠ¤ ê²Œì„</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PeerJS (ì„œë²„ ì—†ëŠ” í†µì‹ ìš©) -->
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <!-- QR Code ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Jua', sans-serif; overflow: hidden; user-select: none; background-color: #111827; color: white; }
        .text-shadow { text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        
        /* ë¡œë¹„ í™”ë©´ */
        .lobby-btn {
            width: 100%; padding: 2rem; font-size: 1.5rem; border-radius: 1rem;
            transition: all 0.2s; font-weight: bold; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }
        .lobby-btn:active { transform: scale(0.98); }

        /* ê²Œì„ í™”ë©´ */
        .vs-badge {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 20;
            background: #fbbf24; border: 6px solid white; border-radius: 50%;
            width: 80px; height: 80px; display: flex; align-items: center; justify-content: center;
            font-size: 2rem; font-weight: 900; color: #000; box-shadow: 0 10px 15px rgba(0,0,0,0.3);
        }
        
        /* ëª¨ë°”ì¼ íˆ¬í‘œ ë²„íŠ¼ */
        .vote-btn {
            height: 100%; width: 100%; border-radius: 1rem;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 4rem; transition: all 0.1s; position: relative; overflow: hidden;
        }
        .vote-btn:active { transform: scale(0.95); filter: brightness(0.9); }
        .vote-btn.selected { border: 8px solid #fbbf24; transform: scale(0.98); }

        /* ê²°ê³¼ ë°” */
        .bar-bg { width: 100%; background: #374151; height: 3rem; border-radius: 99px; overflow: hidden; position: relative; }
        .bar-fill { height: 100%; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; justify-content: flex-end; padding-right: 1rem; font-size: 1.2rem; font-weight: bold; }
        
        /* ì• ë‹ˆë©”ì´ì…˜ */
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* ëª¨ë‹¬ */
        .modal { background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); }
    </style>
</head>
<body class="h-screen w-screen flex flex-col">

    <!-- ================= [1. ë¡œë¹„ í™”ë©´] ================= -->
    <div id="screen-lobby" class="flex-1 flex flex-col items-center justify-center p-6 max-w-md mx-auto w-full">
        <h1 class="text-4xl text-yellow-400 mb-2 text-center leading-tight">2025 í•©ë™ì—°ìˆ˜<br>ë°¸ëŸ°ìŠ¤ ê²Œì„</h1>
        <p class="text-gray-400 mb-8 text-center text-sm">ì‹¤ì‹œê°„ ì¸í„°ë™í‹°ë¸Œ íˆ¬í‘œ ì‹œìŠ¤í…œ</p>
        
        <div class="w-full space-y-4">
            <button onclick="createRoom()" class="lobby-btn bg-indigo-600 hover:bg-indigo-500">
                ğŸ“º ë°© ë§Œë“¤ê¸° (ì§„í–‰ì)
            </button>
            <button onclick="showJoinInput()" class="lobby-btn bg-green-600 hover:bg-green-500">
                ğŸ“± ì°¸ì—¬í•˜ê¸° (ì°¸ê°€ì)
            </button>
        </div>

        <!-- ì°¸ì—¬í•˜ê¸° ì½”ë“œ ì…ë ¥ í¼ -->
        <div id="join-form" class="hidden w-full mt-6 p-4 bg-gray-800 rounded-xl fade-in">
            <label class="block text-gray-400 mb-2 text-center">ì§„í–‰ì í™”ë©´ì˜ 4ìë¦¬ ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”</label>
            <div class="flex gap-2">
                <input type="text" id="room-code-input" maxlength="4" class="flex-1 bg-gray-700 border-2 border-gray-600 rounded-lg px-4 py-3 text-center text-2xl font-mono uppercase focus:border-yellow-400 outline-none" placeholder="CODE">
                <button onclick="joinRoom()" class="bg-yellow-500 text-black font-bold px-6 py-3 rounded-lg hover:bg-yellow-400">ì…ì¥</button>
            </div>
        </div>
        <p id="status-msg" class="mt-4 text-gray-500 text-sm text-center h-5"></p>
    </div>

    <!-- ================= [2. í˜¸ìŠ¤íŠ¸(ì§„í–‰ì) í™”ë©´] ================= -->
    <div id="screen-host" class="hidden h-full flex-col bg-gray-900 relative">
        <!-- ìƒë‹¨ ì •ë³´ë°” -->
        <div class="bg-gray-800 p-3 flex justify-between items-center shadow-lg z-50">
            <div class="flex items-center gap-4">
                <div class="bg-indigo-600 px-3 py-1 rounded-lg font-mono font-bold text-xl">
                    ë°© ì½”ë“œ: <span id="host-room-code" class="text-yellow-300 tracking-widest">----</span>
                </div>
                <div class="text-gray-400 text-sm">
                    ğŸ‘¤ ì ‘ì†ì: <span id="connected-count" class="text-white font-bold text-lg">0</span>ëª…
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="toggleVoting()" id="btn-toggle-vote" class="bg-green-600 px-4 py-2 rounded hover:bg-green-500 font-bold transition-colors">íˆ¬í‘œ ì‹œì‘</button>
                <button onclick="revealResult()" id="btn-reveal" class="bg-gray-600 px-4 py-2 rounded hover:bg-gray-500 font-bold hidden">ê²°ê³¼ ê³µê°œ</button>
                <button onclick="nextQuestion()" id="btn-next" class="bg-indigo-600 px-4 py-2 rounded hover:bg-indigo-500 font-bold hidden">ë‹¤ìŒ ë¬¸ì œ</button>
            </div>
        </div>

        <!-- ê²Œì„ ë©”ì¸ -->
        <div class="flex-1 relative flex flex-col md:flex-row">
            <!-- ì§ˆë¬¸ í…ìŠ¤íŠ¸ (ì˜¤ë²„ë ˆì´) -->
            <div class="absolute top-0 left-0 w-full p-6 z-40 pointer-events-none text-center">
                <span id="q-badge" class="bg-yellow-400 text-black px-3 py-1 rounded-full font-bold shadow-lg mb-2 inline-block">Round 1</span>
                <h2 id="q-title" class="text-3xl md:text-5xl text-shadow font-bold leading-tight drop-shadow-md">ì§ˆë¬¸ ëŒ€ê¸°ì¤‘...</h2>
            </div>

            <!-- VS ë±ƒì§€ -->
            <div class="vs-badge">VS</div>

            <!-- ì˜µì…˜ A -->
            <div class="flex-1 bg-red-600 flex flex-col items-center justify-center p-4 text-center relative overflow-hidden">
                <div class="z-10 mt-16">
                    <div class="text-6xl mb-4 drop-shadow-lg">ğŸ…°ï¸</div>
                    <h3 id="host-opt-a" class="text-3xl md:text-4xl font-bold mb-2">ì˜µì…˜ A</h3>
                    <p id="host-sub-a" class="text-xl text-red-100 bg-red-800/40 px-3 py-1 rounded inline-block">ì„¤ëª…</p>
                </div>
                <!-- íˆ¬í‘œìœ¨ ì°¨ì˜¤ë¥´ëŠ” ë°°ê²½ -->
                <div id="fill-a" class="absolute bottom-0 left-0 w-full bg-black/30 transition-all duration-700" style="height: 0%"></div>
                <div id="count-a" class="absolute bottom-4 left-4 text-4xl font-bold opacity-50 z-20">0</div>
            </div>

            <!-- ì˜µì…˜ B -->
            <div class="flex-1 bg-blue-600 flex flex-col items-center justify-center p-4 text-center relative overflow-hidden">
                <div class="z-10 mt-16">
                    <div class="text-6xl mb-4 drop-shadow-lg">ğŸ…±ï¸</div>
                    <h3 id="host-opt-b" class="text-3xl md:text-4xl font-bold mb-2">ì˜µì…˜ B</h3>
                    <p id="host-sub-b" class="text-xl text-blue-100 bg-blue-800/40 px-3 py-1 rounded inline-block">ì„¤ëª…</p>
                </div>
                <!-- íˆ¬í‘œìœ¨ ì°¨ì˜¤ë¥´ëŠ” ë°°ê²½ -->
                <div id="fill-b" class="absolute bottom-0 left-0 w-full bg-black/30 transition-all duration-700" style="height: 0%"></div>
                <div id="count-b" class="absolute bottom-4 right-4 text-4xl font-bold opacity-50 z-20">0</div>
            </div>
        </div>

        <!-- ê²°ê³¼(íŒ©íŠ¸ì²´í¬) ëª¨ë‹¬ -->
        <div id="result-modal" class="hidden absolute inset-0 modal z-50 flex items-center justify-center p-4">
            <div class="bg-white text-gray-900 rounded-2xl max-w-4xl w-full p-8 shadow-2xl transform transition-all scale-95 opacity-0" id="result-card">
                <div class="text-center mb-6">
                    <h2 class="text-3xl font-bold mb-4">ğŸ“Š íˆ¬í‘œ ê²°ê³¼</h2>
                    <div class="space-y-4 mb-8">
                        <div class="flex items-center gap-3">
                            <div class="text-2xl font-bold text-red-600 w-8">A</div>
                            <div class="bar-bg"><div id="bar-a" class="bar-fill bg-red-500 text-white" style="width: 50%">50%</div></div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="text-2xl font-bold text-blue-600 w-8">B</div>
                            <div class="bar-bg"><div id="bar-b" class="bar-fill bg-blue-500 text-white" style="width: 50%">50%</div></div>
                        </div>
                    </div>
                    <hr class="border-gray-200 my-6">
                    <div class="text-yellow-600 font-bold text-xl tracking-widest mb-2">FACT CHECK</div>
                    <h3 id="fact-title" class="text-2xl md:text-3xl font-bold text-indigo-900 mb-4 break-keep">íŒ©íŠ¸ ì œëª©</h3>
                    <p id="fact-desc" class="text-lg md:text-xl text-gray-700 leading-relaxed break-keep">ì„¤ëª… ë‚´ìš©</p>
                </div>
                <button onclick="closeModal()" class="w-full bg-gray-800 text-white py-4 rounded-xl font-bold text-xl hover:bg-gray-700">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- ================= [3. ê²ŒìŠ¤íŠ¸(ì°¸ê°€ì) í™”ë©´] ================= -->
    <div id="screen-guest" class="hidden h-full flex-col p-4 bg-gray-900">
        <!-- ìƒë‹¨ ìƒíƒœ -->
        <div class="text-center mb-4">
            <div class="inline-block bg-gray-800 px-4 py-1 rounded-full text-sm text-gray-400 mb-2">
                Connected to: <span id="guest-room-code" class="text-white font-bold">----</span>
            </div>
            <h2 id="guest-q-title" class="text-xl font-bold text-white leading-snug break-keep">ì§ˆë¬¸ ëŒ€ê¸°ì¤‘...</h2>
        </div>

        <!-- íˆ¬í‘œ ë²„íŠ¼ ì˜ì—­ -->
        <div id="vote-area" class="flex-1 flex flex-col gap-4 opacity-50 pointer-events-none transition-opacity duration-300">
            <button onclick="sendVote('A')" id="btn-a" class="vote-btn bg-red-600">
                <span class="text-6xl mb-2">ğŸ…°ï¸</span>
                <span id="guest-opt-a" class="text-xl font-bold px-4 text-center">ì„ íƒ A</span>
            </button>
            <button onclick="sendVote('B')" id="btn-b" class="vote-btn bg-blue-600">
                <span class="text-6xl mb-2">ğŸ…±ï¸</span>
                <span id="guest-opt-b" class="text-xl font-bold px-4 text-center">ì„ íƒ B</span>
            </button>
        </div>

        <!-- í•˜ë‹¨ ìƒíƒœ ë©”ì‹œì§€ -->
        <div id="guest-status" class="mt-4 text-center font-bold text-yellow-400 h-8 animate-pulse">
            ì‚¬íšŒìê°€ íˆ¬í‘œë¥¼ ì‹œì‘í•˜ê¸°ë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...
        </div>
    </div>

    <script>
        // --- ë°ì´í„° (ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸) ---
        const questions = [
            {
                title: "Q1. ì˜ˆì‚°ì˜ ì‹ ì´ ë‚´ë ¤ì™”ë‹¤! ë‹¹ì‹ ì˜ ì„ íƒì€?",
                a: "ë¬»ê³  ë”ë¸”ë¡œ ê°€! (100ì–µ)", aSub: "ê°„ì„­ ì‹¬í•¨",
                b: "ì†Œí™•í–‰...? (1ì–µ)", bSub: "ê°„ì„­ ì—†ìŒ",
                factTitle: "ğŸ’¸ í˜„ì‹¤ì€... ëˆì€ B, ê°„ì„­ì€ A?",
                factDesc: "ê²½ê¸°ë„ ë¬¸í™”ì› ì˜ˆì‚°ì˜ ì•½ 75%ê°€ ì§€ìì²´ ë³´ì¡°ê¸ˆì…ë‹ˆë‹¤. ì¬ì • ìë¦½ì´ ì ˆì‹¤í•©ë‹ˆë‹¤!"
            },
            {
                title: "Q2. ì‹ ì…ì‚¬ì› ì±„ìš©, ëˆ„êµ´ ë½‘ì„ê¹Œ?",
                a: "ì¼ë‹¹ë°± ì–´ë²¤ì ¸ìŠ¤", aSub: "3ê°œì›” ë’¤ ì´ì§",
                b: "ì§€ì—­ í† ë°•ì´ ëŒë¶€ì²˜", bSub: "30ë…„ ê·¼ì† (ì»´ë§¹)",
                factTitle: "ğŸƒâ€â™‚ï¸ ë– ë‚˜ëŠ” ì¸ì¬, ë‚¨ëŠ” í˜„ì‹¤",
                factDesc: "ì§ì›ì˜ 30%ê°€ ê³„ì•½ì§ ë“± ë¶ˆì•ˆì •í•œ ìƒíƒœì…ë‹ˆë‹¤. í‘œì¤€ ë³´ìˆ˜ ê·œì •ì´ ì‹œê¸‰í•©ë‹ˆë‹¤."
            },
            {
                title: "Q3. ê±´ë¬¼ ë¦¬ëª¨ë¸ë§, ë‹¹ì‹ ì˜ ì„ íƒì€?",
                a: "ìµœì²¨ë‹¨ ë¹Œë”© (ì§€í•˜ 3ì¸µ)", aSub: "í–‡ë¹› ì•ˆë“¦",
                b: "ìš´ì¹˜ìˆëŠ” í•œì˜¥ (ë¹„ ìƒ™ë‹ˆë‹¤)", bSub: "í™”ì¥ì‹¤ ì¬ë˜ì‹",
                factTitle: "ğŸ  ìš°ë¦¬ ì§‘ ë‚˜ì´ëŠ” 32ì‚´",
                factDesc: "ê²½ê¸°ë„ ë¬¸í™”ì› ê±´ë¬¼ì˜ í‰ê·  ì‚¬ìš© ì—°ìˆ˜ëŠ” ì•½ 32ë…„ì…ë‹ˆë‹¤. ì‹œì„¤ ê°œì„  ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤."
            },
            {
                title: "Q4. í–¥í† ì‚¬ ì—°êµ¬ì†Œ ì±… ë°œê°„, ëŒ€ë°•ì˜ ê¸°ì¤€?",
                a: "í•™ê³„ì˜ ì „ì„¤ (ì°½ê³ í–‰)", aSub: "ì•„ë¬´ë„ ì•ˆ ì½ìŒ",
                b: "ìœ íŠœë¸Œ 100ë§Œë·° (ì•…í”Œ)", bSub: "ì—­ì‚¬ ê³ ì¦ ë…¼ë€",
                factTitle: "ğŸ“š ì—°êµ¬ì†ŒëŠ” ë§ì€ë°...",
                factDesc: "25ê°œ ë¬¸í™”ì›ì´ ì—°êµ¬ì†Œë¥¼ ìš´ì˜ ì¤‘ì´ë‚˜, ì•„ì¹´ì´ë¸Œ ì‚¬ì—… ìˆ˜í–‰ë¥ ì€ ì ˆë°˜ ìˆ˜ì¤€ì…ë‹ˆë‹¤."
            },
            {
                title: "Q5. ì•¼ì™¸ ì¶•ì œ ë‹¹ì¼, ìµœì•…ì˜ ìƒí™©ì€?",
                a: "í­ìš° ì£¼ì˜ë³´ â˜”", aSub: "ì²œë§‰ ë¶€ì—¬ì¡ê³  ì›€",
                b: "ë¯¼ì› í­ì£¼ ğŸ“¢", aSub: "ê²½ì°° ì¶œë™",
                factTitle: "ğŸª ì•¼ì™¸ í–‰ì‚¬ì˜ ë¹„ì• ",
                factDesc: "ëŒ€ë¶€ë¶„ ì‚¬ì—…ì´ ì•¼ì™¸ í–‰ì‚¬ì— ì§‘ì¤‘ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ìš°ì²œ ë§¤ë‰´ì–¼ ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤."
            },
            {
                title: "Q6. ë¬¸í™”í•™êµ ìˆ˜ê°•ë£Œ, ì›ì¥ë‹˜ì˜ ê²°ë‹¨?",
                a: "ì „ë©´ ë¬´ë£Œ ì„ ì–¸", aSub: "ì¬ë£Œë¹„ ì—†ìŒ",
                b: "ìˆ˜ê°•ë£Œ 2ë°° ì¸ìƒ", aSub: "ìˆ˜ê°•ìƒ 1ëª…",
                factTitle: "ğŸ’° ê³µê³µì„± vs ìˆ˜ìµì„±",
                factDesc: "ìë¶€ë‹´ ë¹„ìœ¨ 15%. ê±´ê°•í•œ ìë¦½ì„ ìœ„í•´ ì ì ˆí•œ ìˆ˜ê°•ë£Œ ê°€ì´ë“œë¼ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."
            },
            {
                title: "Q7. í–‰ì‚¬ ê°ì„ ë¶„ìœ„ê¸°, ì–´ë””ê°€ ë‚˜ì€ê°€?",
                a: "ì–´ë¥´ì‹  100% (ì£¼ë¬´ì‹¬)", aSub: "í˜¸ì‘ì€ ì¢‹ìŒ",
                b: "MZì„¸ëŒ€ 100% (í°ë§Œ ë´„)", aSub: "ì™€ì´íŒŒì´ ì°¾ìŒ",
                factTitle: "ğŸ‘´ ê³ ë ¹í™”ëœ ë¬¸í™”ì›",
                factDesc: "ì²­ë…„Â·ì²­ì†Œë…„ í”„ë¡œê·¸ë¨ ë¹„ìœ¨ì´ ë§¤ìš° ë‚®ìŠµë‹ˆë‹¤. ë¯¸ë˜ ì„¸ëŒ€ë¥¼ ìœ„í•œ ë¬¸ì„ ì—´ì–´ì•¼ í•©ë‹ˆë‹¤."
            },
            {
                title: "Q8. í‡´ê·¼ 10ë¶„ ì „, ë” ì†Œë¦„ ë‹ëŠ” ê±´?",
                a: "ì˜ìˆ˜ì¦ 1ì¥ ë¶„ì‹¤", aSub: "5,000ì› ë•Œë¬¸ì— ì•¼ê·¼",
                b: "ì´ëŒ íŒŒì¼ ê¹¨ì§", aSub: "ë‹¤ì‹œ ì‘ì„±í•´ì•¼ í•¨",
                factTitle: "ğŸ“ ì‹œìŠ¤í…œì´ í•„ìš”í•´",
                factDesc: "ì •í™•í•œ ë°ì´í„° ìˆ˜ì§‘ ì²´ê³„ë¥¼ êµ¬ì¶•í•˜ì—¬ ë¶ˆí•„ìš”í•œ í–‰ì • ì†Œëª¨ë¥¼ ì¤„ì—¬ì•¼ í•©ë‹ˆë‹¤."
            },
            {
                title: "Q9. ìš°ë¦¬ ë¬¸í™”ì›ì˜ 10ë…„ ë’¤ ë¯¸ë˜?",
                a: "ê³„íšë´‡ (ì‹œí‚¤ëŠ” ëŒ€ë¡œ)", aSub: "ì¬ë¯¸ ì—†ìŒ",
                b: "ì•¼ìƒë§ˆ (ë‹¥ì¹˜ëŠ” ëŒ€ë¡œ)", aSub: "ë§¤ì¼ì´ ìŠ¤ë¦´",
                factTitle: "ğŸ§­ ë‚˜ì¹¨ë°˜ ì—†ëŠ” í•­í•´",
                factDesc: "31ê°œ ì¤‘ 24ê³³(76%)ì´ ì¤‘ì¥ê¸° ë°œì „ê³„íšì´ ì—†ìŠµë‹ˆë‹¤. ë‚˜ì¹¨ë°˜ì´ í•„ìš”í•©ë‹ˆë‹¤."
            },
            {
                title: "Q10. [Last] ë‚´ë…„ ì´ëŒ ì¡°ì‚¬, ë‚˜ì˜ íƒœë„ëŠ”?",
                a: "ë³µë¶™ (Ctrl+C, V)", aSub: "ë‚˜ì¤‘ì— ì˜ˆì‚° ê¹ì„",
                b: "ì˜í˜¼ì˜ íŒ©íŠ¸ ì…ë ¥", aSub: "ë‚´ë…„ ì¸ë ¥ ì¦ì›",
                factTitle: "ğŸ¤ ë°ì´í„°ëŠ” ìš°ë¦¬ì˜ ë¬´ê¸°",
                factDesc: "ì •ë‹µì€ B! ì—¬ëŸ¬ë¶„ì´ ì±„ì›Œì£¼ì‹œëŠ” ë°ì´í„°ê°€ ìš°ë¦¬ë¥¼ ì§€í‚¤ëŠ” ê°€ì¥ í° ë¬´ê¸°ì…ë‹ˆë‹¤."
            }
        ];

        // --- ì „ì—­ ë³€ìˆ˜ ---
        let peer = null;
        let conn = null; // ê²ŒìŠ¤íŠ¸ìš©
        let connections = []; // í˜¸ìŠ¤íŠ¸ìš© (ì—°ê²°ëœ ê²ŒìŠ¤íŠ¸ë“¤)
        let myRoomCode = "";
        let currentIdx = 0;
        let votes = { A: 0, B: 0 };
        let isVotingOpen = false;
        let isHost = false;

        // DOM ìš”ì†Œ
        const msgEl = document.getElementById('status-msg');
        
        // ================= [PeerJS ê³µí†µ ë¡œì§] =================
        
        function generateRoomCode() {
            // ëœë¤ 4ìë¦¬ ìˆ«ì ì½”ë“œ ìƒì„± (ì¶©ëŒ ë°©ì§€ ìœ„í•´ Prefix ì‚¬ìš©)
            return Math.floor(1000 + Math.random() * 9000).toString();
        }
        
        function getPeerId(code) {
            return `ggcc2025-balance-game-${code}`;
        }

        // ================= [í˜¸ìŠ¤íŠ¸ ë¡œì§] =================
        
        function createRoom() {
            msgEl.innerText = "ë°©ì„ ìƒì„±í•˜ëŠ” ì¤‘...";
            const code = generateRoomCode();
            const peerId = getPeerId(code);
            
            // PeerJS ê°ì²´ ìƒì„±
            peer = new Peer(peerId, {
                debug: 1
            });

            peer.on('open', (id) => {
                console.log('My peer ID is: ' + id);
                myRoomCode = code;
                isHost = true;
                enterHostMode();
            });

            peer.on('connection', (c) => {
                // ê²ŒìŠ¤íŠ¸ ì ‘ì† ì‹œ
                connections.push(c);
                updateConnectionCount();
                
                // í˜„ì¬ ìƒíƒœ ì „ì†¡
                setTimeout(() => {
                    sendStateTo(c); 
                }, 500);

                c.on('data', (data) => {
                    handleDataFromGuest(data);
                });
                
                c.on('close', () => {
                    connections = connections.filter(conn => conn !== c);
                    updateConnectionCount();
                });
            });

            peer.on('error', (err) => {
                console.error(err);
                if(err.type === 'unavailable-id') {
                    createRoom(); // ID ì¶©ëŒì‹œ ì¬ì‹œë„
                } else {
                    alert("ì—°ê²° ì˜¤ë¥˜: " + err.type);
                }
            });
        }

        function enterHostMode() {
            document.getElementById('screen-lobby').classList.add('hidden');
            document.getElementById('screen-host').classList.remove('hidden');
            document.getElementById('screen-host').classList.add('flex');
            document.getElementById('host-room-code').innerText = myRoomCode;
            
            renderHostQuestion();
        }

        function updateConnectionCount() {
            document.getElementById('connected-count').innerText = connections.length;
        }

        function broadcast(data) {
            connections.forEach(c => c.send(data));
        }

        function sendStateTo(conn) {
            const q = questions[currentIdx];
            conn.send({
                type: 'STATE',
                idx: currentIdx,
                title: q.title,
                optA: q.a,
                optB: q.b,
                isOpen: isVotingOpen
            });
        }

        function handleDataFromGuest(data) {
            if (data.type === 'VOTE') {
                if (!isVotingOpen) return;
                // íˆ¬í‘œ ì§‘ê³„
                if (data.choice === 'A') votes.A++;
                if (data.choice === 'B') votes.B++;
                updateHostVoteUI();
            }
        }

        // í˜¸ìŠ¤íŠ¸ UI ì œì–´
        function renderHostQuestion() {
            const q = questions[currentIdx];
            document.getElementById('q-badge').innerText = `Round ${currentIdx + 1}`;
            document.getElementById('q-title').innerText = q.title;
            document.getElementById('host-opt-a').innerText = q.a;
            document.getElementById('host-sub-a').innerText = q.aSub;
            document.getElementById('host-opt-b').innerText = q.b;
            document.getElementById('host-sub-b').innerText = q.bSub;
            
            // ì´ˆê¸°í™”
            votes = { A: 0, B: 0 };
            updateHostVoteUI();
            document.getElementById('fill-a').style.height = '0%';
            document.getElementById('fill-b').style.height = '0%';
            
            // ë²„íŠ¼ ìƒíƒœ
            document.getElementById('btn-toggle-vote').classList.remove('hidden');
            document.getElementById('btn-toggle-vote').innerText = "íˆ¬í‘œ ì‹œì‘";
            document.getElementById('btn-toggle-vote').className = "bg-green-600 px-4 py-2 rounded hover:bg-green-500 font-bold transition-colors";
            document.getElementById('btn-reveal').classList.add('hidden');
            document.getElementById('btn-next').classList.add('hidden');

            isVotingOpen = false;
            broadcast({ type: 'NEW_ROUND', idx: currentIdx, title: q.title, optA: q.a, optB: q.b });
        }

        function toggleVoting() {
            const btn = document.getElementById('btn-toggle-vote');
            if (!isVotingOpen) {
                isVotingOpen = true;
                btn.innerText = "íˆ¬í‘œ ë§ˆê°";
                btn.className = "bg-red-600 px-4 py-2 rounded hover:bg-red-500 font-bold transition-colors animate-pulse";
                broadcast({ type: 'VOTE_START' });
            } else {
                isVotingOpen = false;
                btn.classList.add('hidden');
                document.getElementById('btn-reveal').classList.remove('hidden');
                broadcast({ type: 'VOTE_END' });
            }
        }

        function updateHostVoteUI() {
            const total = votes.A + votes.B;
            if (total > 0) {
                // ë‹¨ìˆœ ìˆ˜ì¹˜ë§Œ ë³´ì—¬ì£¼ê±°ë‚˜, ì‚´ì§ ì°¨ì˜¤ë¥´ëŠ” ëŠë‚Œ (ì•„ì§ ê²°ê³¼ ê³µê°œ ì „ì´ë¯€ë¡œ 50% ë†’ì´ ì œí•œ ë“±ìœ¼ë¡œ íŒíŠ¸ë§Œ ì¤Œ)
                // ì—¬ê¸°ì„œëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ë†’ì´ë¥¼ ë°˜ì˜í•˜ë˜, ìˆ«ìëŠ” ìˆ¨ê¸°ëŠ” ì‹ë„ ê°€ëŠ¥. 
                // ìš”ì²­ì‚¬í•­: "ì‹¤ì‹œê°„ìœ¼ë¡œ ì˜¬ë¼ê°€ëŠ”" -> ë‹¤ ë³´ì—¬ì¤Œ.
                const perA = (votes.A / total) * 100;
                const perB = (votes.B / total) * 100;
                document.getElementById('fill-a').style.height = `${perA}%`;
                document.getElementById('fill-b').style.height = `${perB}%`;
            }
            document.getElementById('count-a').innerText = votes.A;
            document.getElementById('count-b').innerText = votes.B;
        }

        function revealResult() {
            const q = questions[currentIdx];
            const total = votes.A + votes.B || 1;
            const perA = Math.round((votes.A / total) * 100);
            const perB = 100 - perA;

            // ëª¨ë‹¬ ë‚´ìš© ì±„ìš°ê¸°
            document.getElementById('bar-a').style.width = `${perA}%`;
            document.getElementById('bar-a').innerText = `${perA}% (${votes.A}ëª…)`;
            document.getElementById('bar-b').style.width = `${perB}%`;
            document.getElementById('bar-b').innerText = `${perB}% (${votes.B}ëª…)`;
            
            document.getElementById('fact-title').innerHTML = q.factTitle;
            document.getElementById('fact-desc').innerHTML = q.factDesc;

            // ëª¨ë‹¬ í‘œì‹œ
            const modal = document.getElementById('result-modal');
            const card = document.getElementById('result-card');
            modal.classList.remove('hidden');
            setTimeout(() => {
                card.classList.remove('scale-95', 'opacity-0');
                card.classList.add('scale-100', 'opacity-100');
            }, 50);

            document.getElementById('btn-reveal').classList.add('hidden');
            document.getElementById('btn-next').classList.remove('hidden');
        }

        function closeModal() {
            const modal = document.getElementById('result-modal');
            const card = document.getElementById('result-card');
            card.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 200);
        }

        function nextQuestion() {
            currentIdx++;
            if (currentIdx < questions.length) {
                renderHostQuestion();
            } else {
                alert("ëª¨ë“  ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!");
                // ì¢…ë£Œ í™”ë©´ ë¡œì§ (ìƒëµ)
            }
        }


        // ================= [ê²ŒìŠ¤íŠ¸ ë¡œì§] =================

        function showJoinInput() {
            document.getElementById('join-form').classList.remove('hidden');
        }

        function joinRoom() {
            const code = document.getElementById('room-code-input').value;
            if (code.length !== 4) {
                alert("4ìë¦¬ ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }
            
            msgEl.innerText = "ì—°ê²° ì‹œë„ ì¤‘...";
            const hostId = getPeerId(code);

            // ê²ŒìŠ¤íŠ¸ìš© Peer ìƒì„± (ID ìë™ ìƒì„±)
            peer = new Peer();
            
            peer.on('open', () => {
                conn = peer.connect(hostId);

                conn.on('open', () => {
                    msgEl.innerText = "ì—°ê²° ì„±ê³µ!";
                    myRoomCode = code;
                    enterGuestMode();
                });

                conn.on('data', (data) => {
                    handleDataFromHost(data);
                });

                conn.on('close', () => {
                    alert("í˜¸ìŠ¤íŠ¸ì™€ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.");
                    location.reload();
                });

                // 5ì´ˆ ë’¤ì—ë„ ì—°ê²° ì•ˆë˜ë©´ ì—ëŸ¬ ì²˜ë¦¬
                setTimeout(() => {
                    if (!conn.open) {
                        msgEl.innerText = "ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì½”ë“œë¥¼ í™•ì¸í•˜ì„¸ìš”.";
                    }
                }, 5000);
            });

            peer.on('error', (err) => {
                console.error(err);
                msgEl.innerText = "ì—°ê²° ì˜¤ë¥˜. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
            });
        }

        function enterGuestMode() {
            document.getElementById('screen-lobby').classList.add('hidden');
            document.getElementById('screen-guest').classList.remove('hidden');
            document.getElementById('screen-guest').classList.add('flex');
            document.getElementById('guest-room-code').innerText = myRoomCode;
        }

        function handleDataFromHost(data) {
            if (data.type === 'STATE' || data.type === 'NEW_ROUND') {
                // í™”ë©´ ê°±ì‹ 
                document.getElementById('guest-q-title').innerText = data.title;
                document.getElementById('guest-opt-a').innerText = data.optA.split('(')[0]; // ê´„í˜¸ ë’¤ ì œê±°í•´ì„œ ê¹”ë”í•˜ê²Œ
                document.getElementById('guest-opt-b').innerText = data.optB.split('(')[0];
                
                // ì„ íƒ ì´ˆê¸°í™”
                resetGuestButtons();

                if (data.isOpen) openGuestVote();
                else closeGuestVote("ë‹¤ìŒ ë¼ìš´ë“œ ëŒ€ê¸°ì¤‘...");
            }
            else if (data.type === 'VOTE_START') {
                openGuestVote();
            }
            else if (data.type === 'VOTE_END') {
                closeGuestVote("íˆ¬í‘œê°€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
        }

        function openGuestVote() {
            const area = document.getElementById('vote-area');
            const status = document.getElementById('guest-status');
            area.classList.remove('opacity-50', 'pointer-events-none');
            status.innerText = "íˆ¬í‘œí•˜ì„¸ìš”!";
            status.className = "mt-4 text-center font-bold text-green-400 h-8 animate-pulse";
        }

        function closeGuestVote(msg) {
            const area = document.getElementById('vote-area');
            const status = document.getElementById('guest-status');
            area.classList.add('opacity-50', 'pointer-events-none');
            status.innerText = msg;
            status.className = "mt-4 text-center font-bold text-yellow-400 h-8";
        }

        function sendVote(choice) {
            // UI í”¼ë“œë°±
            resetGuestButtons();
            const btn = document.getElementById(choice === 'A' ? 'btn-a' : 'btn-b');
            btn.classList.add('selected');
            
            // ì„œë²„ ì „ì†¡
            conn.send({ type: 'VOTE', choice: choice });
            
            // íˆ¬í‘œ í›„ ì ê¸ˆ (ì„ íƒ ë³€ê²½ ë¶ˆê°€í•˜ê²Œ í•˜ë ¤ë©´ ì—¬ê¸° ì£¼ì„ í•´ì œ)
            // closeGuestVote("íˆ¬í‘œ ì™„ë£Œ! ê²°ê³¼ ëŒ€ê¸°ì¤‘...");
            document.getElementById('guest-status').innerText = "íˆ¬í‘œ ì™„ë£Œ! (ë³€ê²½ ê°€ëŠ¥)";
        }

        function resetGuestButtons() {
            document.getElementById('btn-a').classList.remove('selected');
            document.getElementById('btn-b').classList.remove('selected');
        }

    </script>
</body>
</html>